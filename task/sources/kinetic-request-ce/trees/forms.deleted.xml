<tree schema_version="1.0">
    <sourceName>Kinetic Request CE</sourceName>
    <sourceGroup>Forms</sourceGroup>
    <type>Tree</type>
    <status>Active</status>
    <taskTree builder_version="" schema_version="1.0" version="">
        <name>Deleted</name>
        <author></author>
        <notes></notes>
        <lastID>47</lastID>
        <request>
            <task definition_id="system_start_v1" id="start" name="Start" x="297" y="-89">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages></messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_8</task>
                </dependents>
            </task>
            <task definition_id="kinetic_task_tree_find_by_name_v1" id="kinetic_task_tree_find_by_name_v1_7" name="Check Validity of Tree" x="1063" y="439">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Error Message</parameter>
                    <parameter id="source" label="Source" menu="" required="true" tooltip="The source for the tree you want to find.">&lt;%= @space_attributes['Task Source Name']%&gt;</parameter>
                    <parameter id="group" label="Group" menu="" required="true" tooltip="The group of the tree you want to find.">Submissions &gt; &lt;%= @kapp['Slug']%&gt; &gt; &lt;%= @form['Slug']%&gt;</parameter>
                    <parameter id="name" label="Name" menu="" required="true" tooltip="Name of tree to find (e.g. Completed)">&lt;%=@results['Submission Action']['output']%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="Not Exists" type="Complete" value="@results['Check Validity of Tree']['Exists'].to_s.downcase != &quot;true&quot;">system_noop_v1_35</task>
                    <task label="Exists" type="Complete" value="@results['Check Validity of Tree']['Exists'].to_s.downcase == &quot;true&quot;">kinetic_task_tree_delete_v1_46</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_8" name="Is Shared Engine" x="297" y="-22">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%= ['true','yes'].include?(@space_attributes['Shared Workflow Engine'].to_s.downcase) ||
@space_attributes['Task Server Space Slug'] == 'shared' %&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="Dedicated Task Engine" type="Complete" value="!['true','yes'].include?(@results['Is Shared Engine']['output'].to_s.downcase)">system_noop_v1_17</task>
                    <task label="Shared Task Engine" type="Complete" value="['true','yes'].include?(@results['Is Shared Engine']['output'].to_s.downcase)">system_noop_v1_13</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_13" name="Do Nothing - Shared" x="114" y="88">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_47</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_17" name="Dedicated Task Engine" x="297" y="89">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_26</task>
                </dependents>
            </task>
            <task definition_id="system_join_v1" id="system_join_v1_22" name="Dedicated Branch Complete" x="713" y="571">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="type" label="Type:" menu="All,Any,Some" required="true" tooltip="How many dependents must be completed before continuing?">Any</parameter>
                    <parameter dependsOnId="type" dependsOnValue="Some" id="number" label="Number:" menu="" required="false" tooltip="If some, how many?"></parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_34</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_24" name="Complete" x="109" y="528">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents></dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_26" name="Raw Workflow Processes" x="297" y="184">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%= 
# Type of event this tree expects
event_type = 'Form'
# Name of the attribute
attribute_name = 'Submission Workflow'

# Returns an array of unique attribute values
def action_values(attributes, attribute_name)
    (attributes.has_key?(attribute_name) ? 
        attributes[attribute_name] : 
        []
    ).uniq
end

# Declare the default return variable
values = ['Closed - False', 'Created - False', 'Deleted - False', 'Updated - False', 'Submitted - False']
# Check attributes
if @event['Type'] == event_type
    # Check the form for custom processes
    values = action_values(@form_attributes, attribute_name)
    # if no values were present, check the kapp for standard processes
    values = action_values(@kapp_attributes, attribute_name) if values.size == 0
    # if no values were present, check the kapp for standard processes
    values = action_values(@space_attributes, attribute_name) if values.size == 0
    # If no values were present, default to 'False'
    values = ['Closed - False', 'Created - False', 'Deleted - False', 'Updated - False', 'Submitted - False'] if values.size == 0
end
# return the values as json
values.to_json
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_head_v1_27</task>
                </dependents>
            </task>
            <task definition_id="system_loop_head_v1" id="system_loop_head_v1_27" name="Submission Actions Loop Begin" x="297" y="338">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="data_source" label="Data Source:" menu="" required="true" tooltip="The source that contains the data to use to create each task in the loop.">&lt;actions&gt;
  &lt;action&gt;Closed&lt;/action&gt;
  &lt;action&gt;Created&lt;/action&gt;
  &lt;action&gt;Deleted&lt;/action&gt;
  &lt;action&gt;Submitted&lt;/action&gt;
  &lt;action&gt;Updated&lt;/action&gt;
&lt;/actions&gt;</parameter>
                    <parameter id="loop_path" label="Loop Path:" menu="" required="true" tooltip="The XPath statement to indicate what data records to process.">/actions/action</parameter>
                    <parameter id="var_name" label="Variable Name:" menu="" required="false" tooltip="The local variable name used to represent the data used in loop tasks."></parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_tail_v1_28</task>
                    <task label="" type="Complete" value="">utilities_echo_v1_29</task>
                </dependents>
            </task>
            <task definition_id="system_loop_tail_v1" id="system_loop_tail_v1_28" name="Submission Actions Loop End" x="296" y="429">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="type" label="Type:" menu="All,Some,Any" required="true" tooltip="How many loop processes must be completed before continuing?">All</parameter>
                    <parameter dependsOnId="type" dependsOnValue="Some" id="number" label="Number:" menu="" required="false" tooltip="If some, how many?"></parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_47</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_29" name="Submission Action" x="461" y="187">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%=@results['Submission Actions Loop Begin']['Value']%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_30</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_30" name="Submission Action Workflow Processes" x="595" y="176">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%= 
# Parse the raw processes array
raw_processes = JSON.parse(@results['Raw Workflow Processes']['output'])
# Action
action = @results['Submission Action']['output']

# Check processes
values = raw_processes.select { |value|
  /^#{action}.*/.match(value)
}.map { |value| 
  captures = /^#{action}\s-\s(.*)$/.match(value).captures
  captures[0]
}.uniq

# If no values were present, default to 'False'
values = ['False'] if values.size == 0

# return the values as json
values.to_json
%&gt;
</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_38</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_31" name="Do Nothing" x="583" y="416">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_34</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_32" name="Dedicated Workflow" x="914" y="392">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">kinetic_task_tree_find_by_name_v1_7</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_33" name="Custom Workflow - Ignored" x="727" y="425">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_34</task>
                </dependents>
            </task>
            <task definition_id="system_join_v1" id="system_join_v1_34" name="Process Complete" x="514" y="525">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="type" label="Type:" menu="All,Any,Some" required="true" tooltip="How many dependents must be completed before continuing?">All</parameter>
                    <parameter dependsOnId="type" dependsOnValue="Some" id="number" label="Number:" menu="" required="false" tooltip="If some, how many?"></parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_tail_v1_39</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_35" name="Tree Does Not Exist" x="1062" y="595">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_22</task>
                </dependents>
            </task>
            <task definition_id="system_loop_head_v1" id="system_loop_head_v1_37" name="Action Processes Loop Begin" x="730" y="288">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="data_source" label="Data Source:" menu="" required="true" tooltip="The source that contains the data to use to create each task in the loop.">&lt;%=@results['Submission Action Processes']['output']%&gt;</parameter>
                    <parameter id="loop_path" label="Loop Path:" menu="" required="true" tooltip="The XPath statement to indicate what data records to process.">/processes/process</parameter>
                    <parameter id="var_name" label="Variable Name:" menu="" required="false" tooltip="The local variable name used to represent the data used in loop tasks."></parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="No Workflow" type="Complete" value="JSON.parse(@results['Submission Action Workflow Processes']['output']).inject(false) { |result, value| &#10;  result || ['no', 'false'].include?(value.to_s.strip.downcase)&#10;}">system_noop_v1_31</task>
                    <task label="Custom Workflow" type="Complete" value="JSON.parse(@results['Submission Action Workflow Processes']['output']).reject { |value| &#10;  ['no', 'false', 'yes', 'true'].include?(value.to_s.strip.downcase)&#10;}.size &gt; 0">system_noop_v1_33</task>
                    <task label="Dedicated Workflow" type="Complete" value="JSON.parse(@results['Submission Action Workflow Processes']['output']).inject(false) { |result, value| &#10;  result || ['yes', 'true'].include?(value.to_s.strip.downcase)&#10;}">system_noop_v1_32</task>
                    <task label="" type="Complete" value="">system_loop_tail_v1_39</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_38" name="Submission Action Processes" x="726" y="184">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%
xml = "&lt;processes&gt;"
JSON.parse(@results['Submission Action Workflow Processes']['output']).each { |process|
  xml += "&lt;process&gt;#{process}&lt;/process&gt;"
}
xml += "&lt;/processes&gt;"
%&gt;&lt;%= xml %&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_head_v1_37</task>
                </dependents>
            </task>
            <task definition_id="system_loop_tail_v1" id="system_loop_tail_v1_39" name="Action Processes Loop End" x="451" y="428">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="type" label="Type:" menu="All,Some,Any" required="true" tooltip="How many loop processes must be completed before continuing?">All</parameter>
                    <parameter dependsOnId="type" dependsOnValue="Some" id="number" label="Number:" menu="" required="false" tooltip="If some, how many?"></parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_loop_tail_v1_28</task>
                </dependents>
            </task>
            <task definition_id="kinetic_task_tree_delete_v1" id="kinetic_task_tree_delete_v1_46" name="Delete Tree" x="884" y="506">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Error Message</parameter>
                    <parameter id="source" label="Source" menu="" required="true" tooltip="The source for the tree you want to delete.">&lt;%= @space_attributes['Task Source Name']%&gt;</parameter>
                    <parameter id="group" label="Group" menu="" required="true" tooltip="The group of the tree you want to delete.">Submissions &lt;%= @kapp['Slug']%&gt; &gt; &lt;%= @form['Slug']%&gt;</parameter>
                    <parameter id="name" label="Name" menu="" required="false" tooltip="Name of tree to delete (e.g. Complete). If none specified all for the given source/group will be deleted.">&lt;%=@results['Submission Actions Loop Begin']['Value']%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_join_v1_22</task>
                </dependents>
            </task>
            <task definition_id="system_junction_v1" id="system_junction_v1_47" name="END" x="110" y="439">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters></parameters>
                <messages>
                    <message type="Create"></message>
                    <message type="Update"></message>
                    <message type="Complete"></message>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_noop_v1_24</task>
                </dependents>
            </task>
        </request>
    </taskTree>
</tree>